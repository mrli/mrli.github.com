<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | lioooo]]></title>
  <link href="http://mrli.github.io/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://mrli.github.io/"/>
  <updated>2014-04-07T20:25:55+08:00</updated>
  <id>http://mrli.github.io/</id>
  <author>
    <name><![CDATA[lioooo]]></name>
    <email><![CDATA[lb563@foxmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[收集制作一个常用的脚本集合Gems(lioooo_utils)]]></title>
    <link href="http://mrli.github.io/blog/2014/04/07/build-liooo-utils-gems/"/>
    <updated>2014-04-07T16:27:20+08:00</updated>
    <id>http://mrli.github.io/blog/2014/04/07/build-liooo-utils-gems</id>
    <content type="html"><![CDATA[<p>工作中把一些常用的脚本功能收集到一些,经过几次的使用.发现脚本功能还算比较的稳定.于是做一个常用gem方便以后直接使用.</p>

<h4>setp1:</h4>

<p>制作gem需要用到第三方库文件<a href="https://github.com/technicalpickles/jeweler">Jeweler</a></p>

<ol>
<li><p><code>gem install jeweler</code></p></li>
<li><p><code>jeweler lioooo_utils</code></p></li>
<li><p><code>cd lioooo_utils &amp;&amp; subl ./lioooo_utils</code></p></li>
<li><p>修改项目目录中的Rakefile 描述信息等</p></li>
</ol>


<!--more-->


<h4>setp2:</h4>

<p>编写库文件,也就是gem的功能代码</p>

<ol>
<li><p>在项目文件中Gemfile中添加上所需要的第三方库文件</p></li>
<li><p>代码编写好后执行 <code>bundle install</code></p></li>
</ol>


<h4>setp3:</h4>

<ol>
<li><p>将写好的功能生成一个版本用于版本的控制等</p>

<p> <code>rake version:write MAJOR=0 MINOR=1 PATCH=0</code></p></li>
<li><p>在本地进行安装测试,若测试没有问题就release</p>

<p> <code>rake install</code></p></li>
<li><p>在测试时会遇到找不到<strong>lib</strong>库目录.这时需要在rakefile中添加</p>

<p> <code>gem.files = Dir.glob('lib/**/*.rb')</code></p>

<p>把库文件引入到加载路径中去.</p></li>
</ol>


<h4>setp4:</h4>

<p>发布版本到rubygems方便进行二次安装.</p>

<p>若发布成功后,便可以通过gem包的安装方式进行包的安装 <code>gem install lioooo_utils</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RubySocket 编程例子]]></title>
    <link href="http://mrli.github.io/blog/2014/03/10/ruby-socket-study/"/>
    <updated>2014-03-10T16:43:24+08:00</updated>
    <id>http://mrli.github.io/blog/2014/03/10/ruby-socket-study</id>
    <content type="html"><![CDATA[<p>Ruby 的 Socket 类在默认情况下并不会被载入,它需要使用 require'socket' 导入.
其中包括了各种用于TCP套接字、UDP套接字的类,以及必要的基本类型。</p>

<p><strong>服务器部分</strong>
server.rb</p>

<p>```
require &lsquo;socket&rsquo;</p>

<p>server = TCPServer.new 2000 # Server bound to port 2000</p>

<p>loop do
  client = server.accept    # Wait for a client to connect
  client.puts &ldquo;Hello !&rdquo;
  client.puts &ldquo;Time is #{Time.now}&rdquo;
  client.close
end
```</p>

<p><strong>客户端部分</strong>
client.rb</p>

<p>```
require &lsquo;socket&rsquo;</p>

<p>s = TCPSocket.new &lsquo;localhost&rsquo;, 2000</p>

<p>while line = s.gets # Read lines from socket
  puts line         # and print them
end</p>

<p>s.close             # close socket when done
```</p>

<!--more-->


<p><strong>分别运行脚本输出:</strong></p>

<p><code>
Hello !
Time is 2014-03-11 01:08:18 +0800
</code></p>

<p><strong>端口绑定的注意事项</strong></p>

<h5>规 则 1 : 不 要 使 用 0~1024 之 间 的 端 口</h5>

<p>这 些 端 口 是 作 为 熟 知(well-known)端口并保留给系统使用的。例如HTTP默认使用端口80,SMTP默认使用端口25,rsync默认使用端口873。绑定到这些端口通常需要root权限。</p>

<h5>规 则 2 : 不 要 使 用 49 000~65 535 之 间 的 端 口</h5>

<p>这 些 都 是 临 时(ephemeral )端口 。通常是由那些不需要运行在预定义端口,而只是需要一些端口作为临时之需的服务使用。它们也是后面所要讲到的连接协商(connection negotiation)过程的一部分。选择该范围内的端口可能会对一些用户造成麻烦。除此之外,</p>

<h5>建议使用1025~48 999之间的端口</h5>

<p>需要注意的是：如果你打算选用其中的一个作为服务器端口,那你应该看一下IANA的注册端口列表1,确保你的选择不会和其他流行的服务器冲突。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[delayed_job 学习]]></title>
    <link href="http://mrli.github.io/blog/2014/01/10/delayed-job-in-ruby/"/>
    <updated>2014-01-10T16:37:13+08:00</updated>
    <id>http://mrli.github.io/blog/2014/01/10/delayed-job-in-ruby</id>
    <content type="html"><![CDATA[<h5>初始化环境</h5>

<p>```</p>

<pre><code>echo "'delayed_job_active_record','4.0.0'" &gt;&gt; Rails.root/Gemfile

cd Rails.root; bundle install

bundle exec rake generate delayed_job:active_record

rake db:migrate
</code></pre>

<p>```</p>

<p>以上执行完毕后基本的环境已经准备ok!</p>

<!--more-->


<h5>启动delayed_job</h5>

<p><code>
cd Rails.root; script/delayed_job start
</code></p>

<h5>添加一个delayed_job 到代码中</h5>

<p>对于ruby 中的任何一个对象,都可以添加到delayed_job中去
例如:</p>

<p>```
class Myjob
  def do_something</p>

<pre><code> #your code
</code></pre>

<p>  end
end
Myjob.new.delay.do_something
```</p>

<h5>配置默认设置 <a href="https://github.com/collectiveidea/delayed_job#gory-details">参考配置</a></h5>

<p>在rails中可以自定义修改<strong><em>delayed_job</em></strong>的默认配置</p>

<p><code>
cd Rails.root; vi config/initializers/delayed_job_config.rb
</code></p>

<p><code>
Delayed::Worker.destroy_failed_jobs = false
Delayed::Worker.sleep_delay = 60
Delayed::Worker.max_attempts = 3
Delayed::Worker.max_run_time = 5.minutes
Delayed::Worker.read_ahead = 10
Delayed::Worker.default_queue_name = 'default'
Delayed::Worker.delay_jobs = !Rails.env.test?
</code></p>

<h5>其它相关</h5>

<p><strong><strong><a href="https://github.com/ejschmitt/delayed_job_web">delayed_job</a></strong></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[backup 学习]]></title>
    <link href="http://mrli.github.io/blog/2012/05/20/backup-xue-xi/"/>
    <updated>2012-05-20T23:19:00+08:00</updated>
    <id>http://mrli.github.io/blog/2012/05/20/backup-xue-xi</id>
    <content type="html"><![CDATA[<p>用于备件数据库和文件等(主要是用ruby写的)文章参考: <a href="https://github.com/meskyanichi/backup">https://github.com/meskyanichi/backup</a></p>

<p>安装</p>

<p>```</p>

<pre><code> $ gem install backup
</code></pre>

<p>```</p>

<p>生成一个backup配置</p>

<p>```</p>

<pre><code> $ backup generate:model --trigger db_backup --databases='mysql' --compressors='gzip' --config-path= ~/dev_study/gem/backup_study/
</code></pre>

<p>```</p>

<!--more-->


<p>打开刚才生成的配置文件进行配置 <code>$ subl ~/dev_study/gem/backup_study</code></p>

<p>执行命令来进行备件:</p>

<p>```</p>

<pre><code>  $ backup perform --trigger db_backup  --root-path=~/dev_study/gem/backup_study/
</code></pre>

<p>```</p>

<p>加上自备份功能:</p>

<ul>
<li> gem install whenever (参考文章: <a href="https://github.com/javan/whenever">https://github.com/javan/whenever</a>)</li>
<li><p> cd ~/dev_study/gem/backup_study/</p></li>
<li><p> wheneverize.</p></li>
<li> subl . 修改config/schedule.rb文件(当你修改了whenever的时候 执行命令:whenever &mdash;update-crontab 来更新自动执行任务事件 )
加入自动执行的命令:</li>
</ul>


<p>```
every 1.day, :at => &lsquo;12:13 am&rsquo; do
  command &ldquo;backup perform &mdash;trigger db_backup  &mdash;root-path=~/dev_study/gem/backup_study&rdquo;
end</p>

<p>```</p>

<p>由上就可以在每天 12:13 的时候执行backup 命令,而这个命令是备件数据</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[jeweler学习]]></title>
    <link href="http://mrli.github.io/blog/2012/05/19/jewelerxue-xi/"/>
    <updated>2012-05-19T10:41:00+08:00</updated>
    <id>http://mrli.github.io/blog/2012/05/19/jewelerxue-xi</id>
    <content type="html"><![CDATA[<p>Jeweler 提供给ruby开发者二个强大的功能:</p>

<ul>
<li>用来管理和发布RubyGem项目版本</li>
<li>用特有的框架来生成一个新的RubyGem项目</li>
</ul>


<h2>下面我们就开始学习这个强大而简单的工具</h2>

<h1>安装</h1>

<pre><code>$ gem install jeweler
</code></pre>

<h1>生成项目文件</h1>

<p>当你安装好"jeweler"后,你就可以用"jeweler"命令来生成新的项目像下面一样:<br/>
这个需要一些git的配置信息(例如: name, email github account etc ..) 不用担心 &ldquo;jeweler"会帮你管理这些配置的</p>

<pre><code>$ jeweler ~/dev_study/gem/mrlic
</code></pre>

<p>生成过程中可以会发现:</p>

<!--more-->


<p>No github.user found in ~/.gitconfig. Please tell git about your GitHub account (see <a href="http://github.com/blog/180-local-github-config">http://github.com/blog/180-local-github-config</a> for details). For example: git config &mdash;global github.user defunkt</p>

<p>意思说你要给"jeweler"一些关于github的信息处理方法很简单,在终端窗口执行命令:</p>

<pre><code>$ git config --global github.user you_github_account_name(你在github上的用户名)
</code></pre>

<p>进入到项目根目录:</p>

<pre><code>$ cd ~/dev_study/gem/mrlic 
</code></pre>

<p>安装依赖的gem包:</p>

<pre><code>$ bundle install 
</code></pre>

<p>顺便说一名喜欢用 &ldquo;<a href="http://ruby.taobao.org">http://ruby.taobao.org</a>"做为gem包的镜像地址,如果你喜欢你可以照下面来做<br/>
在 Gemfile中把"<a href="http://rubygems.org">http://rubygems.org</a>"替换成"<a href="http://ruby.taobao.org">http://ruby.taobao.org</a>&rdquo;,这样做的好处是安装包的时候速度快  <br/>
同时我在安装的过程中也出现错误,关于"bundle"和"rcov"版本的问题(由于错误信息较多,这里不一一讲述我把我的方法贴出来)<br/>
我处理的方法是:在Gemfile中把bundle的版本修改为＂1.1.3＂，"rcov" 版本修改为 &ldquo;0.9.11&rdquo;,等修改完后再次执行命令</p>

<pre><code>$ bundle install 
</code></pre>

<p>下面是我的Gemfile文件内容
```</p>

<pre><code>    source "http://ruby.taobao.org"
    group :development do
      gem "shoulda", "&gt;= 0"
      gem "rdoc", "~&gt; 3.12"
      gem "bundler", "~&gt; 1.1.3"
      gem "jeweler", "~&gt; 1.8.3"
      gem "rcov", "0.9.11"
    end
</code></pre>

<p>```</p>

<h1>写自己的代码</h1>

<p>[最核心的功能]在项目中文件"lib/mrlic.rb",因为这只是我测试的项目我写了一个方法,这个方法就是输出一字符串
```</p>

<pre><code>def desc
     puts "this is mrli command collect"
end
</code></pre>

<p>```
给gem生成版本号,用于管理</p>

<pre><code>$　rake version:write MAJOR=0 MINOR=1 PATCH=0
</code></pre>

<p>执行命令(可以查看当前的版本)如果想了解更多的rake命令到项目根目录中执行<code>$ rake -T</code></p>

<pre><code>$ rake version
</code></pre>

<p>从本地文件中安装这个gem(mrlic)</p>

<pre><code>$ rake install
</code></pre>

<p>在运行的过程中你会发现错误信息:</p>

<p>```</p>

<pre><code>rake aborted!
"FIXME" or "TODO" is not a description
</code></pre>

<p><code>
我的处理方法是:在项目Rakefile文件中把内容为:
</code>
  gem.summary = %Q{TODO: one-line summary of your gem}
  gem.description = %Q{longer description of your gem}
<code>
修改为
</code></p>

<pre><code>gem.summary = "one-line summary of your gem"
gem.description = "longer description of your gem"
</code></pre>

<p><code>
修改后再次执行命令`$ rake install `如果成功的话会出现提示消息:
</code></p>

<pre><code>Successfully built RubyGem
</code></pre>

<p>  Name: mrlic
  Version: 0.1.0
  File: mrlic-0.1.0.gem</p>

<pre><code>Executing "ruby -S gem install ./pkg/mrlic-0.1.0.gem":
ruby -S gem install ./pkg/mrlic-0.1.0.gem
Successfully installed mrlic-0.1.0
1 gem installed
</code></pre>

<p>```</p>

<h1>测试</h1>

<p>打开新的终端输入命令<code>$ pry</code>(<a href="pry.github.com">pry是一个非常好的命令交互工具</a>)<br/>
```</p>

<pre><code>[1] pry(main)&gt; require "mrlic"
=&gt; true
[2] pry(main)&gt; desc
this is mrli command collect
=&gt; nil
[3] pry(main)&gt; 
</code></pre>

<p>```
可见"mrlic"gem已经在本志安装好了</p>

<h1>分享</h1>

<p>下面我们把这个gem放到github上分享给大家</p>

<ul>
<li> 在github上新一个和"mrlic"相同命名项目(没有账号的就注册一个"<a href="http://www.github.com">http://www.github.com</a>")</li>
<li> 回到项目文件中 $ cd ~/dev_study/mrlic</li>
<li> git add .</li>
<li> git commit -a -m &ldquo;init mrlic&rdquo;</li>
<li> git pull (把刚才新建的项目pull下来和本地的合并)</li>
<li> $ rake release (在发布的过程中会让你输入"rubygems"的账号,没有的就注册一个)</li>
</ul>


<p>执行命令<code>$ rake release</code>如果一切顺利的话会出现信息:
```</p>

<pre><code>    rm -r pkg/mrlic-0.1.0.gem
    Committing mrlic.gemspec
    Pushing master to origin
    Tagging v0.1.0
    Pushing v0.1.0 to origin
    Generated: mrlic.gemspec
    mrlic.gemspec is valid.
      Successfully built RubyGem
      Name: mrlic
      Version: 0.1.0
      File: mrlic-0.1.0.gem
    Executing "gem push ./pkg/mrlic-0.1.0.gem":
    gem push ./pkg/mrlic-0.1.0.gem
    Enter your RubyGems.org credentials.
    Don't have an account yet? Create one at http://rubygems.org/sign_up
       Email:   lb563@foxmail.com
    Password:  
    Pushing gem to https://rubygems.org...
    Signed in.
    Pushing gem to https://rubygems.org...
    Successfully registered gem: mrlic (0.1.0)
</code></pre>

<p>```
到此你的gem已经发布到公网上,并可以让其它人使用了<br/>
更多信息参考 <a href="https://github.com/technicalpickles/jeweler">jeweler</a></p>
]]></content>
  </entry>
  
</feed>
